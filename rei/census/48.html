<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="">
        <base href="https://molbie.co/" />
        <link rel="apple-touch-icon" sizes="180x180" href="https://molbie.co/images/favicon/apple-touch-icon.png" />
        <link rel="icon" type="image/png" href="https://molbie.co/images/favicon/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="https://molbie.co/images/favicon/favicon-194x194.png" sizes="194x194" />
        <link rel="icon" type="image/png" href="https://molbie.co/images/favicon/android-chrome-192x192.png" sizes="192x192" />
        <link rel="icon" type="image/png" href="https://molbie.co/images/favicon/favicon-16x16.png" sizes="16x16" />
        <link rel="manifest" href="https://molbie.co/images/favicon/manifest.json" />
        <link rel="mask-icon" href="https://molbie.co/images/favicon/safari-pinned-tab.svg" color="#305eab" />
        <link rel="shortcut icon" href="https://molbie.co/images/favicon/favicon.ico" />
        <meta name="msapplication-TileColor" content="#000000">
        <meta name="msapplication-TileImage" content="https://molbie.co/images/favicon/mstile-144x144.png">
        <meta name="msapplication-config" content="https://molbie.co/images/favicon/browserconfig.xml">
        <meta name="theme-color" content="#000000">

        <title>Molbie</title>

        <!-- Bootstrap -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous" />
        <link href="https://molbie.co/css/ie10-viewport-bug-workaround.css" rel="stylesheet" />

        <!-- Template -->
        <link href="https://molbie.co/css/icons.css" rel="stylesheet" />
        <link href="https://molbie.co/css/fonts.css" rel="stylesheet" />
        <link href="https://molbie.co/css/template.css" rel="stylesheet" />

        <!-- Page -->
        <link href="https://api.mapbox.com/mapbox-gl-js/v1.9.1/mapbox-gl.css" rel="stylesheet" />
        <link href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.css" rel="stylesheet" />
        <link href="https://molbie.co/rei/css/map.css" rel="stylesheet" />

        <!--[if lt IE 9]><script src="https://molbie.co/js/ie8-responsive-file-warning.js"></script><![endif]-->
        <script src="https://molbie.co/js/ie-emulation-modes-warning.js"></script>

        <!--[if lt IE 9]>
                <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
                <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
            <![endif]-->
    </head>
    <body>
        <a name="top" id="top"></a>
        <nav class="navbar navbar-default navbar-fixed-top">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="" title="Molbie">
                        <img src="https://molbie.co/images/logo.svg" alt="Molbie Logo">
                    </a>
                </div>
                <div id="navbar" class="navbar-collapse collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <li class="active">
                            <a href="" title="Home">
                                <span class="icon-home"></span>
                                <span data-title="Home">Home</span>
                            </a>
                        </li>
                        <li>
                            <a href="https://github.com/Molbie" title="Open Source">
                                <span class="icon-opensource"></span>
                                <span data-title="Open Source">Open Source</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        <div class="container-fluid collectionView">
            <div class="item">
                <div class="content">
                    <section>
                        <div id="map" style="height: 990px;"></div>
                        <div id="geocoder" class="geocoder"></div>
                        <div class="map-overlay">
                            <div id="mapOverlayContent">
                                <p><strong id="geoName">NAME</strong><br /><span>ID: </span><span id="geoId">-</span><br /><span>Land Sq Miles: </span><span id="landArea">-</span><br /><span>Water Sq Miles: </span><span id="waterArea">-</span></p>
                                <p><strong>POPULATION</strong><br /><span>Total: </span><span id="population">-</span></p>
                                <p><strong>HOUSEHOLDS</strong><br /><span>Total: </span><span id="households">-</span></p>
                                <p><strong>INCOME</strong><br /><span>Family: </span><span id="familyIncome">-</span><br /><span>Household: </span><span id="householdIncome">-</span><br /><span>Per Capita: </span><span id="perCapitaIncome">-</span></p>
                                <p><strong>HOUSE VALUE</strong><br /><span>Median: </span><span id="houseValue">-</span><br /><span>Upper Quartile: </span><span id="upperHouseValue">-</span><br /><span>Lower Quartile: </span><span id="lowerHouseValue">-</span></p>
                                <p><strong>HOUSING UNITS</strong><br /><span>Total: </span><span id="housingUnits">-</span></p>
                                <p><strong>VACANCY</strong><br /><span>Rate: </span><span id="vacancyRate">-</span></p>
                                <p><strong>POVERTY</strong><br /><span>Rate: </span><span id="povertyRate">-</span></p>
                                <p><strong>UNEMPLOYMENT</strong><br /><span>Rate: </span><span id="unemploymentRate">-</span></p>
                                <p><strong>AGE</strong><br /><span>Median: </span><span id="medianAge">-</span></p>
                            </div>
                            <div id="reportCard">
                                <p><strong>REPORT CARD</strong></p>
                                <p id="populationGradeContainer"><span>Population Growth</span><br /><span>Change: </span><span id="populationGradeRate">-</span><br /><span>Grade: </span><span><strong id="populationGradeLetter">-</strong></span></p>
                                <p id="householdIncomeGradeContainer"><span>Household Income Growth</span><br /><span>Change: </span><span id="householdIncomeGradeRate">-</span><br /><span>Grade: </span><span><strong id="householdIncomeGradeLetter">-</strong></span></p>
                                <p id="houseValueGradeContainer"><span>House Value Growth</span><br /><span>Change: </span><span id="houseValueGradeRate">-</span><br /><span>Grade: </span><span><strong id="houseValueGradeLetter">-</strong></span></p>
                            </div>
                        </div>
                    </section>
                </div>
                <div class="content">
                    <canvas id="populationChart"></canvas>
                    <canvas id="householdsChart"></canvas>
                    <canvas id="incomeChart"></canvas>
                    <canvas id="houseValueChart"></canvas>
                    <canvas id="housingUnitsChart"></canvas>
                    <canvas id="vacancyChart"></canvas>
                    <canvas id="povertyChart"></canvas>
                    <canvas id="unemploymentChart"></canvas>
                    <canvas id="medianAgeChart"></canvas>
                </div>
            </div>
        </div>
        <footer class="footer">
            <div class="container">
                <p class="text-muted">Copyright &copy; 2016-2020 Molbie LLC. All rights reserved.</p>
            </div>
        </footer>
        <!-- Bootstrap -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <script src="https://molbie.co/js/ie10-viewport-bug-workaround.js"></script>

        <!-- Template -->
        <script src="https://molbie.co/js/template.js"></script>

        <!-- Page -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
        <script src="https://www.chartjs.org/dist/2.9.3/Chart.min.js"></script>
        <script src="https://api.mapbox.com/mapbox-gl-js/v1.9.1/mapbox-gl.js"></script>
        <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.min.js"></script>
        <script src="https://molbie.co/rei/js/template.js"></script>
        <script src="https://molbie.co/rei/js/math.js"></script>
        <script src="https://molbie.co/rei/js/census.js"></script>
        <script src="https://molbie.co/rei/js/mapdata.js"></script>
        <script src="https://molbie.co/rei/js/mapcontroller.js"></script>
        <script src="https://molbie.co/rei/js/mapcharts.js"></script>
        <script src="https://molbie.co/rei/js/rules.js"></script>
        <script>
            $(window).load(function() {
                'use strict';

                var geography = CensusGeography.tract;
                var urlPrefix = "https://molbie.co/rei/census/" + geography;
                var geoId = "48";
                var mapData = new MapData(geoId, urlPrefix + "/data/");
                var reportCard = new ReportCard(RuleGradingSystem.letters);
                var ruleEngine = new RuleEngine();
                ruleEngine.addPopulationGrowthRules();
                ruleEngine.addHouseholdMedianIncomeGrowthRules();
                ruleEngine.addHouseValueGrowthRules();
                var mapCharts = new MapCharts();
                var overlay = new MapOverlay();
                var onUpdate = function(geoId) {
                    var geoData = mapData.getGeoData(geoId);
                    mapCharts.update(geoData);
                };
                var onUpdateOverlay = function(geoId) {
                    overlay.setGeoId(geoId);
                    overlay.setGeoName(mapData.getName(geoId));
                    overlay.setLandArea(mapData.getLandArea(geoId));
                    overlay.setWaterArea(mapData.getWaterArea(geoId));
                    overlay.setPopulation(mapData.getPopulationTotal(geoId));
                    overlay.setHouseholds(mapData.getHouseholdTotal(geoId));
                    overlay.setMedianAge(mapData.getMedianAge(geoId));
                    overlay.setFamilyIncome(mapData.getFamilyIncome(geoId));
                    overlay.setHouseholdIncome(mapData.getHouseholdIncome(geoId));
                    overlay.setPerCapitaIncome(mapData.getPerCapitaIncome(geoId));
                    overlay.setHousingUnits(mapData.getHousingUnitsTotal(geoId));
                    overlay.setHouseValue(mapData.getMedianHouseValue(geoId));
                    overlay.setUpperHouseValue(mapData.getUpperQuartileHouseValue(geoId));
                    overlay.setLowerHouseValue(mapData.getLowerQuartileHouseValue(geoId));
                    overlay.setVacancyRate(mapData.getVacancyRate(geoId));
                    overlay.setPovertyRate(mapData.getPovertyRate(geoId));
                    overlay.setUnemploymentRate(mapData.getUnemploymentRate(geoId));

                    var geoData = mapData.getGeoData(geoId);
                    var grades = ruleEngine.evaluate(geography, geoData);
                    reportCard.applyGrades(grades);
                };
                var onClearOverlay = function() {
                    overlay.setGeoId(null);
                    overlay.setGeoName(null);
                    overlay.setLandArea(null);
                    overlay.setWaterArea(null);
                    overlay.setPopulation(null);
                    overlay.setHouseholds(null);
                    overlay.setMedianAge(null);
                    overlay.setFamilyIncome(null);
                    overlay.setHouseholdIncome(null);
                    overlay.setPerCapitaIncome(null);
                    overlay.setHousingUnits(null);
                    overlay.setHouseValue(null);
                    overlay.setUpperHouseValue(null);
                    overlay.setLowerHouseValue(null);
                    overlay.setVacancyRate(null);
                    overlay.setPovertyRate(null);
                    overlay.setUnemploymentRate(null);
                };
                var mapController = new MapController("pk.eyJ1IjoicHJvZ3JhbW1lci1icmlhbiIsImEiOiJjajF5YmNleHQwMGNhMnFxa3dvaHZmaDZjIn0.NQfth9E2BbhzMBSkQMv0JA", 
                                                      urlPrefix + "/polygons/" + geoId + ".json", 
                                                      [-99.9018, 31.9686], 
                                                      onUpdate,
                                                      onUpdateOverlay,
                                                      onClearOverlay);
            });
        </script>
    </body>
</html>